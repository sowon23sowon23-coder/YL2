<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Share Love Joy Hope</title>
  <style>
    :root{
      --bg1:#f6e7eb;
      --bg2:#f3cfd8;
      --ink:#3b2b31;
      --muted:#7a6a71;
      --brand:#b12b62;
      --btn:#5a2c57;
      --shadow: 0 10px 24px rgba(0,0,0,.12);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#eee;
      display:flex;
      justify-content:center;
      padding:22px;
      color:var(--ink);
    }

    /* single flow phone */
    .phone{
      width: 340px;
      max-width: 95vw;
      height: 680px;
      border-radius: 16px;
      background: linear-gradient(var(--bg1), var(--bg2));
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,.06);
      overflow:hidden;
      position:relative;
    }
    <section id="screen" style="display:none;">
  <div class="screenTop">
    <div class="screenTitle">Share Love Joy Hope</div>
    <div class="screenSub">Scan QR to upload</div>
  </div>

  <div class="slideWrap">
    <img id="screenImg" alt="slide"/>
    <div class="screenText">
      <div id="screenNick" class="screenNick"></div>
      <div id="screenMsg" class="screenMsg"></div>
      <div id="screenDate" class="screenDate"></div>
    </div>
  </div>

  <div class="screenHint">Press F11 for fullscreen</div>
</section>

    .page{
      position:absolute;
      inset:0;
      padding: 22px 18px;
      display:none;
    }
    .page.active{ display:block; }

    .top{ text-align:center; margin-bottom:14px; }
    .pill{
      display:inline-block;
      padding:10px 16px;
      border-radius:14px;
      background: rgba(255,255,255,.7);
      box-shadow: 0 6px 14px rgba(0,0,0,.08);
      color: var(--brand);
      font-weight:900;
      letter-spacing:.2px;
    }
    .sub{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }

    /* main */
    .uploadBox{
      margin: 18px auto 12px;
      width:100%;
      height:220px;
      border-radius:16px;
      background: rgba(255,255,255,.65);
      border: 2px solid rgba(177,43,98,.35);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
    }
    .uploadBox img{ width:100%; height:100%; object-fit:cover; display:none; }
    .uploadBox .hint{
      position:absolute;
      text-align:center;
      padding: 0 12px;
      color: rgba(59,43,49,.55);
      font-size:13px;
    }

    .row{ margin:10px 0; }
    label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    input[type="text"]{
      width:100%;
      height:38px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.12);
      padding:0 14px;
      background: rgba(255,255,255,.85);
      outline:none;
    }
    .smallBtn{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.85);
      border-radius:999px;
      padding:8px 12px;
      font-size:12px;
      cursor:pointer;
      user-select:none;
    }
    .smallBtn input{ display:none; }

    .btn{
      width:100%;
      height:44px;
      border:none;
      border-radius:999px;
      cursor:pointer;
      font-weight:900;
      letter-spacing:.4px;
      box-shadow: 0 10px 18px rgba(0,0,0,.12);
      margin-top:10px;
      background: var(--btn);
      color:#fff;
    }
    .btn.ghost{
      background: rgba(255,255,255,.75);
      color: rgba(59,43,49,.85);
      border: 1px solid rgba(0,0,0,.12);
      box-shadow:none;
    }

    /* gallery */
    .backLink{
      display:inline-block;
      font-size:12px;
      color: rgba(59,43,49,.7);
      cursor:pointer;
      user-select:none;
      margin: 2px 0 10px;
    }
    .galleryScroll{
      height:560px;
      overflow-y:auto;
      padding-right:6px;
    }
    .heartStack{
      position:relative;
      height:1200px;
      width:100%;
    }

    /* heart flip card */
    .heartCard{
      position:absolute;
      perspective: 900px;
      cursor:pointer;
      user-select:none;
    }
    .heartInner{
      width:100%;
      height:100%;
      position:relative;
      transform-style: preserve-3d;
      transition: transform 700ms ease;
    }
    .heartCard.showBack .heartInner{ transform: rotateY(180deg); }

    .heartFace{
      position:absolute;
      inset:0;
      backface-visibility:hidden;
      filter: drop-shadow(0 12px 14px rgba(0,0,0,.14));
    }
    .heartBack{ transform: rotateY(180deg); }

    /* heart mask */
    .heartShape{
      width:100%;
      height:100%;
      background: rgba(255,255,255,.92);
      overflow:hidden;
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 18px;
      -webkit-mask-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 90'><path d='M50 82C25 66 8 51 8 32C8 19 18 10 31 10C39 10 46 14 50 20C54 14 61 10 69 10C82 10 92 19 92 32C92 51 75 66 50 82Z' fill='black'/></svg>");
      -webkit-mask-size:100% 100%;
      -webkit-mask-repeat:no-repeat;
      mask-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 90'><path d='M50 82C25 66 8 51 8 32C8 19 18 10 31 10C39 10 46 14 50 20C54 14 61 10 69 10C82 10 92 19 92 32C92 51 75 66 50 82Z' fill='black'/></svg>");
      mask-size:100% 100%;
      mask-repeat:no-repeat;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    .heartShape img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    /* ✅ centered text inside heart */
    .heartTextWrap{
      width: 78%;
      height: 78%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      gap:8px;
      padding: 8px 6px;
    }
    .heartNick{
      font-weight:900;
      line-height:1.1;
      color: rgba(59,43,49,.92);
      font-size: 13px;
      max-width: 100%;
      word-break: break-word;
    }
    .heartMsg{
      font-weight:600;
      color: rgba(59,43,49,.82);
      line-height:1.18;
      max-width: 100%;
      word-break: break-word;
      white-space: pre-wrap;
      /* font-size is auto-set by JS to fit */
    }

    /* detail */
    .overlay{
      position:absolute;
      inset:0;
      background: rgba(255,255,255,.35);
      backdrop-filter: blur(6px);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .detailCard{
      width:92%;
      background: rgba(255,255,255,.92);
      border-radius:16px;
      box-shadow: var(--shadow);
      overflow:hidden;
      border:1px solid rgba(0,0,0,.08);
      position:relative;
    }
    .closeX{
      position:absolute;
      right:10px;
      top:10px;
      width:28px;
      height:28px;
      border-radius:999px;
      border:none;
      background: rgba(0,0,0,.08);
      cursor:pointer;
      font-weight:900;
    }
    .detailImg{ height:280px; width:100%; background:#eee; overflow:hidden; }
    .detailImg img{ width:100%; height:100%; object-fit:cover; display:block; }
    .detailBody{ padding:12px 14px 14px; text-align:center; }
    .tag{ font-size:11px; letter-spacing:.5px; color: rgba(59,43,49,.6); margin-bottom:8px; }
    .fromPill{
      margin:0 auto 10px;
      width:70%;
      height:36px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.12);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      background: rgba(255,255,255,.85);
      font-weight:900;
      color: rgba(59,43,49,.85);
      font-size:12px;
    }
    .avatarDot{
      width:18px;height:18px;border-radius:999px;background: rgba(177,43,98,.18);
      display:inline-block; position:relative;
    }
    .avatarDot::after{
      content:"";
      position:absolute; left:50%; top:52%;
      transform: translate(-50%,-50%);
      width:8px;height:8px;border-radius:999px;
      background: rgba(177,43,98,.55);
    }
    .detailMsg{ font-size:12px; color: rgba(59,43,49,.85); line-height:1.35; margin-bottom:10px; padding:0 8px; white-space:pre-wrap; }
    .date{ font-size:11px; color: rgba(59,43,49,.55); padding-bottom:6px; }
  </style>


</head>

<body>
  <div class="phone">

    <!-- MAIN -->
    <section class="page active" id="page-main">
      <div class="top">
        <div class="pill">Share Love Joy Hope</div>
        <div class="sub">Share your own<br/>LOVE · JOY · HOPE moment here.</div>
      </div>

      <div class="uploadBox">
        <img id="previewImg" alt="preview" />
        <div class="hint" id="previewHint">Upload your image</div>
      </div>

      <div class="row">
        <label>Image</label>
        <label class="smallBtn">
          ⬆ Upload image
          <input type="file" id="fileInput" accept="image/*" />
        </label>
      </div>

      <div class="row">
        <label>Nickname (10 chars max)</label>
        <input type="text" id="nickInput" maxlength="10" placeholder="Please enter a nickname" />
      </div>

      <div class="row">
        <label>Description (30 chars max)</label>
        <input type="text" id="msgInput" maxlength="30" placeholder="Please write a short description" />
      </div>

      <button class="btn" id="submitAndGo">♡ CLICK TO UPLOAD ♡</button>
      <button class="btn ghost" id="justGoGallery">VIEW THE GALLERY</button>
    </section>

    <!-- GALLERY -->
    <section class="page" id="page-gallery">
      <div class="top">
        <div class="pill" style="font-size:12px;padding:10px 14px;">
          Share your own<br/>LOVE · JOY · HOPE moment here.
        </div>
      </div>

      <div class="backLink" id="backToMain">← BACK</div>

      <div class="galleryScroll">
        <div class="heartStack" id="heartStack"></div>
      </div>
    </section>

    <!-- DETAIL -->
    <section class="page" id="page-detail">
      <div class="top">
        <div class="pill" style="font-size:12px;padding:10px 14px;">
          Share your own<br/>LOVE · JOY · HOPE moment here.
        </div>
      </div>

      <div class="overlay">
        <div class="detailCard">
          <button class="closeX" id="closeDetail">X</button>
          <div class="detailImg"><img id="detailImg" alt="detail"/></div>
          <div class="detailBody">
            <div class="tag">FROM</div>
            <div class="fromPill"><span class="avatarDot"></span><span id="detailNick">Nick</span></div>
            <div class="detailMsg" id="detailMsg">Message</div>
            <div class="date" id="detailDate">YYYY / MM / DD</div>
          </div>
        </div>
      </div>
    </section>

  </div>

<script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  const SUPABASE_URL = "https://jhkeupkswnqeytroliwn.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_dCtuDm5n0rmgxcouaWY55Q_2PbiVAYA";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  /***************
   * Storage + Data
   ***************/
  const LS_KEY = "yl_entries_v3";

  function loadEntries(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return seedEntries();
      const arr = JSON.parse(raw);
      if(!Array.isArray(arr)) return seedEntries();
      return arr;
    }catch{
      return seedEntries();
    }
  }
  function saveEntries(entries){ localStorage.setItem(LS_KEY, JSON.stringify(entries)); }

  function seedEntries(){
    const demo = [
      {
        id: crypto.randomUUID(),
        nick: "YOYO",
        msg: "the place I often come\nwith my mom",
        imgDataUrl:
          "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'><defs><linearGradient id='g' x1='0' x2='1'><stop offset='0' stop-color='%23f1b7c5'/><stop offset='1' stop-color='%23b12b62'/></linearGradient></defs><rect width='100%25' height='100%25' fill='url(%23g)'/><circle cx='400' cy='330' r='170' fill='rgba(255,255,255,.35)'/><text x='50%25' y='55%25' font-size='44' text-anchor='middle' fill='white' font-family='Arial'>Demo Photo</text></svg>",
        createdAt: Date.now() - 86400000 * 2
      },
      {
        id: crypto.randomUUID(),
        nick: "Celco",
        msg: "Happy birthday!\nYogurtland :)",
        imgDataUrl:
          "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'><rect width='100%25' height='100%25' fill='%23c9d9ff'/><rect x='70' y='90' width='660' height='620' rx='40' fill='rgba(255,255,255,.55)'/><text x='50%25' y='52%25' font-size='40' text-anchor='middle' fill='%233c5bb6' font-family='Arial'>Demo Photo</text></svg>",
        createdAt: Date.now() - 86400000 * 5
      }
    ];
    saveEntries(demo);
    return demo;
  }

  /***************
   * Elements
   ***************/
  const pageMain    = document.getElementById("page-main");
  const pageGallery = document.getElementById("page-gallery");
  const pageDetail  = document.getElementById("page-detail");

  const fileInput   = document.getElementById("fileInput");
  const previewImg  = document.getElementById("previewImg");
  const previewHint = document.getElementById("previewHint");
  const nickInput   = document.getElementById("nickInput");
  const msgInput    = document.getElementById("msgInput");

  const submitAndGo   = document.getElementById("submitAndGo");
  const justGoGallery = document.getElementById("justGoGallery");
  const backToMain    = document.getElementById("backToMain");

  const heartStack = document.getElementById("heartStack");

  const closeDetail = document.getElementById("closeDetail");
  const detailImg   = document.getElementById("detailImg");
  const detailNick  = document.getElementById("detailNick");
  const detailMsg   = document.getElementById("detailMsg");
  const detailDate  = document.getElementById("detailDate");

  let entries = loadEntries();
  let currentUploadDataUrl = "";
  let flipTimer = null;

  /***************
   * Navigation
   ***************/
  function show(page){
    [pageMain, pageGallery, pageDetail].forEach(p => p.classList.remove("active"));
    page.classList.add("active");
  }

  /***************
   * Main: upload preview
   ***************/
  fileInput.addEventListener("change", async (e) => {
    const file = e.target.files?.[0];
    if(!file) return;

    const dataUrl = await readAsDataURL(file);
    currentUploadDataUrl = dataUrl;

    previewImg.src = dataUrl;
    previewImg.style.display = "block";
    previewHint.style.display = "none";
  });

  function readAsDataURL(file){
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  submitAndGo.addEventListener("click", () => {
    const nick = nickInput.value.trim();
    const msg  = msgInput.value.trim();

    if(!currentUploadDataUrl){ alert("Please upload an image."); return; }
    if(!nick){ alert("Please enter a nickname."); return; }
    if(!msg){ alert("Please write a short description."); return; }

    const newEntry = {
      id: crypto.randomUUID(),
      nick,
      msg,
      imgDataUrl: currentUploadDataUrl,
      createdAt: Date.now()
    };

    entries = [newEntry, ...entries];
    saveEntries(entries);

    // reset
    nickInput.value = "";
    msgInput.value = "";
    fileInput.value = "";
    currentUploadDataUrl = "";
    previewImg.style.display = "none";
    previewHint.style.display = "block";

    renderGallery();
    show(pageGallery);
  });

  justGoGallery.addEventListener("click", () => {
    renderGallery();
    show(pageGallery);
  });

  backToMain.addEventListener("click", () => show(pageMain));

  /***************
   * Detail
   ***************/
  closeDetail.addEventListener("click", () => show(pageGallery));

  function openDetail(entry){
    detailImg.src = entry.imgDataUrl;
    detailNick.textContent = entry.nick;
    detailMsg.textContent = entry.msg;

    const d = new Date(entry.createdAt);
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    detailDate.textContent = `${yyyy} / ${mm} / ${dd}`;

    show(pageDetail);
  }

  /***************
   * Gallery render
   * ✅ Left hearts start with TEXT
   * ✅ Right hearts start with PHOTO
   * ✅ Text is centered, auto-shrinks to fit
   ***************/
  function renderGallery(){
    heartStack.innerHTML = "";

    const positions = [
      { top:  55, leftPct: 36, size: 175, side:"left"  },
      { top: 190, leftPct: 68, size: 175, side:"right" },
      { top: 325, leftPct: 36, size: 175, side:"left"  },
      { top: 460, leftPct: 68, size: 175, side:"right" },
      { top: 595, leftPct: 36, size: 175, side:"left"  },
      { top: 730, leftPct: 68, size: 175, side:"right" },
      { top: 865, leftPct: 52, size: 175, side:"left"  },
      { top: 1000,leftPct: 36, size: 175, side:"right" },
    ];

    const shown = entries.slice(0, 16);

    shown.forEach((entry, idx) => {
      const pos = positions[idx % positions.length];

      const card = document.createElement("div");
      card.className = "heartCard";
      card.style.top  = pos.top + "px";
      card.style.left = pos.leftPct + "%";
      card.style.transform = "translateX(-50%)";
      card.style.width  = pos.size + "px";
      card.style.height = Math.round(pos.size * 0.92) + "px";
      card.dataset.side = pos.side;

      // start state:
      // - showBack = TEXT
      // - left hearts: text first => showBack true
      // - right hearts: photo first => showBack false
      if(pos.side === "left"){
        card.classList.add("showBack");
      }

      card.innerHTML = `
        <div class="heartInner">
          <!-- FRONT: photo -->
          <div class="heartFace heartFront">
            <div class="heartShape">
              <img alt="photo" src="${entry.imgDataUrl}">
            </div>
          </div>

          <!-- BACK: text -->
          <div class="heartFace heartBack">
            <div class="heartShape">
              <div class="heartTextWrap">
                <div class="heartNick">${escapeHtml(entry.nick)}</div>
                <div class="heartMsg">${escapeHtml(entry.msg)}</div>
              </div>
            </div>
          </div>
        </div>
      `;

      card.addEventListener("click", () => openDetail(entry));
      heartStack.appendChild(card);
    });

    // ✅ auto-fit text in each heart (shrink font if needed)
    requestAnimationFrame(() => {
      document.querySelectorAll(".heartCard").forEach(card => fitHeartText(card));
    });

    startFlipLoop();
  }

  function fitHeartText(card){
    const wrap = card.querySelector(".heartTextWrap");
    const msgEl = card.querySelector(".heartMsg");
    if(!wrap || !msgEl) return;

    // available height is wrap height; shrink message font until it fits
    // (nickname fixed-ish; message shrinks)
    const maxFont = 12;
    const minFont = 8;

    let font = maxFont;
    msgEl.style.fontSize = font + "px";

    // give layout a tick
    for(let i=0; i<20; i++){
      const fits = wrap.scrollHeight <= wrap.clientHeight;
      if(fits) break;
      font -= 0.5;
      if(font < minFont){ font = minFont; break; }
      msgEl.style.fontSize = font + "px";
    }
  }

  /***************
   * Flip loop (3 seconds)
   * Left & right both flip every 3s, but start state differs:
   * - left: text first
   * - right: photo first
   ***************/
  function startFlipLoop(){
    if(flipTimer) clearInterval(flipTimer);

    flipTimer = setInterval(() => {
      document.querySelectorAll(".heartCard").forEach(card => {
        card.classList.toggle("showBack"); // toggles between photo<->text
      });
    }, 3000);
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // init
  const isScreenMode = new URLSearchParams(location.search).get("mode") === "screen";

const screenEl = document.getElementById("screen");
const phoneEl  = document.querySelector(".phone");

const screenImg  = document.getElementById("screenImg");
const screenNick = document.getElementById("screenNick");
const screenMsg  = document.getElementById("screenMsg");
const screenDate = document.getElementById("screenDate");

let slideIdx = 0;
let slideTimer = null;
let refreshTimer = null;

function formatDate(ts){
  const d = new Date(ts);
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,"0");
  const dd = String(d.getDate()).padStart(2,"0");
  return `${yyyy} / ${mm} / ${dd}`;
}

function renderSlide(){
  // 최신순(이미 entries가 최신순으로 쌓이지만, 안전하게 정렬)
  const sorted = [...entries].sort((a,b) => b.createdAt - a.createdAt);
  if(sorted.length === 0) return;

  if(slideIdx >= sorted.length) slideIdx = 0;
  const e = sorted[slideIdx];

  screenImg.src = e.imgDataUrl;
  screenNick.textContent = e.nick;
  screenMsg.textContent  = e.msg;
  screenDate.textContent = formatDate(e.createdAt);
}

function startScreenSlideshow(){
  // 7초마다 다음(원하면 5~8초로 조절)
  if(slideTimer) clearInterval(slideTimer);
  slideTimer = setInterval(() => {
    slideIdx += 1;
    renderSlide();
  }, 7000);

  // 3초마다 entries 다시 읽기 (localStorage 기반 “같은 PC 탭” 갱신용)
  if(refreshTimer) clearInterval(refreshTimer);
  refreshTimer = setInterval(() => {
    entries = loadEntries();
    renderSlide();
  }, 3000);

  // 같은 PC에서 다른 탭이 저장하면 즉시 반영
  window.addEventListener("storage", (ev) => {
    if(ev.key === LS_KEY){
      entries = loadEntries();
      slideIdx = 0; // 새 글 들어오면 최신부터 다시 보여주기
      renderSlide();
    }
  });

  renderSlide();
}

if(isScreenMode){
  // phone UI 숨기고 screen UI로 전환
  phoneEl.style.display = "none";
  screenEl.style.display = "block";

  // 갤러리 flip 루프 같은 건 굳이 안 돌아도 됨
  if(flipTimer) clearInterval(flipTimer);

  startScreenSlideshow();
}

  renderGallery();
</script>


</body>
</html>
